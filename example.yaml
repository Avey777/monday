# Settings

#gopath: /Users/vincent/golang # Optional, default to user's $GOPATH env var

# Local applications

<: &graphql-local
  name: graphql
  path: github.com/eko/graphql # Will find in GOPATH (as executable is "go")
  watch: true # Default: false (do not watch directory)
  executable: go
  args:
    - run
    - cmd/main.go

<: &grpc-api-local
  name: grpc-api
  path: github.com/eko/grpc-api # Will find in GOPATH (as executable is "go")
  watch: true # Default: false (do not watch directory)
  executable: go
  args:
    - run
    - main.go

<: &elasticsearch-local
  name: elasticsearch
  path: /Users/vincent/dev/docker
  watch: true # Default: false (do not watch directory)
  executable: docker
  args:
    - start
    - -i
    - elastic

# Kubernetes forwards

<: &kubernetes-context preprod

# Example of Kubernetes local port-forward: forward a specific pod port locally
# This is cool for avoiding to run applications locally and hit an environment from your
# local machine
<: &graphql-forward
  name: graphql
  type: kubernetes
  values:
    context: *kubernetes-context
    namespace: backend
    labels:
      app: graphql
    hostname: graphql.svc.local # Optional
    ports:
     - 8080:8000

# Example of Kubernetes remote-forward: this replaces your current pod in an environment with
# a proxy that allows us to forward traffic locally. This is really cool to debug on an environment
# but we disaprove using it on your production environment!
<: &grpc-api-kubernetes-remote
  name: grpc-api
  type: kubernetes-remote
  values:
    context: *kubernetes-context
    namespace: backend
    labels:
      app: grpc-api
    ports:
     - 8080:8080
     - 8001:8001

<: &grpc-api-forward
  name: grpc-api
  type: kubernetes
  values:
    context: *kubernetes-context
    namespace: backend
    labels:
      app: grpc-api
    hostname: grpc-api.svc.local # Optional
    ports:
     - 8080:8080

# Example of SSH local forward: forward a specific remote port locally
# Here, I'm forwarding on port 8080 locally my production website (port 80)
<: &composieux-fr-local
  name: composieux-fr-local
  type: ssh
  values:
    remote: vincent@composieux.fr # SSH <user>@<hostname>
    args:
      - "-i/Users/name/.ssh/private_key"
    hostname: composieux.fr.svc.local # Optional
    ports:
     - 8080:80

# Example of SSH remote forward: forward all trafic on remote to a local application
# You don't have to do this at home but here, I'm forwarding all my production traffic
# on my local machine.
<: &composieux-fr-remote
  name: composieux-fr-remote
  type: ssh-remote
  values:
    remote: vincent@composieux.fr # SSH <user>@<hostname>
    args:
      - "-i/Users/name/.ssh/private_key"
    ports:
     - 8080:80

# Projects

projects:
 - name: full
   local:
    - *graphql-local
    - *grpc-api-local
    - *elasticsearch-local

 - name: graphql
   local:
    - *graphql-local
   forward:
    - *grpc-api-forward

 - name: forward-only
   forward:
    - *graphql-forward
    - *grpc-api-forward

 - name: forward-composieux-website
   forward:
    - *composieux-fr
